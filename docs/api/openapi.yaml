openapi: 3.0.3
info:
  title: Financbase Admin Dashboard API
  description: |
    Comprehensive API documentation for the Financbase Admin Dashboard - a financial management platform with advanced automation, integrations, and analytics capabilities.
    
    ## Authentication
    
    All API endpoints (except `/api/health`) require authentication using Clerk.
    Include the session token in the Authorization header:
    
    ```
    Authorization: Bearer <clerk_session_token>
    ```
    
    ## Rate Limiting
    
    API requests are rate-limited to prevent abuse:
    - **Standard endpoints**: 100 requests per 15 minutes
    - **Authentication endpoints**: 20 requests per 15 minutes
    - **Webhook endpoints**: 1000 requests per hour
    
    ## Error Handling
    
    All errors follow a consistent format:
    ```json
    {
      "error": {
        "code": "ERROR_CODE",
        "message": "Human-readable error message",
        "timestamp": "2024-01-01T00:00:00Z",
        "requestId": "req_1234567890"
      }
    }
    ```
    
    ## Response Format
    
    Successful responses follow this format:
    ```json
    {
      "success": true,
      "data": { ... },
      "meta": {
        "timestamp": "2024-01-01T00:00:00Z",
        "requestId": "req_1234567890"
      }
    }
    ```
    
  version: 2.0.0
  contact:
    name: Financbase API Support
    email: support@financbase.com
    url: https://docs.financbase.com
  license:
    name: Proprietary
    url: https://financbase.com/legal

servers:
  - url: http://localhost:3000/api
    description: Development server
  - url: https://api.financbase.com/api
    description: Production server
  - url: https://staging.api.financbase.com/api
    description: Staging server

tags:
  - name: Health
    description: Health check and monitoring endpoints
  - name: Authentication
    description: Authentication and user management
  - name: Accounts
    description: Financial account management
  - name: Transactions
    description: Transaction management and tracking
  - name: Invoices
    description: Invoice creation, management, and payment tracking
  - name: Expenses
    description: Expense tracking and management
  - name: Clients
    description: Client management
  - name: Projects
    description: Project management for freelancers
  - name: Time Tracking
    description: Time entry and tracking
  - name: Real Estate
    description: Real estate property and investment management
  - name: Workflows
    description: Workflow automation and execution
  - name: Webhooks
    description: Webhook management
  - name: Integrations
    description: Third-party integrations
  - name: Marketplace
    description: Plugin marketplace
  - name: Analytics
    description: Analytics and reporting
  - name: AI
    description: AI-powered features

paths:
  /health:
    get:
      tags:
        - Health
      summary: Health check endpoint
      description: Returns the health status of the application and its services
      operationId: getHealth
      responses:
        '200':
          description: Application is healthy
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthStatus'
        '503':
          description: Application is unhealthy
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthStatus'

  /accounts:
    get:
      tags:
        - Accounts
      summary: List accounts
      description: Retrieve a paginated list of financial accounts
      operationId: listAccounts
      security:
        - ClerkAuth: []
      parameters:
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/LimitParam'
        - name: search
          in: query
          description: Search term for account name
          required: false
          schema:
            type: string
        - name: accountType
          in: query
          description: Filter by account type
          required: false
          schema:
            type: string
            enum: [checking, savings, credit_card, investment, loan, other]
        - name: status
          in: query
          description: Filter by account status
          required: false
          schema:
            type: string
            enum: [active, inactive, closed]
      responses:
        '200':
          description: List of accounts
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AccountListResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'
    
    post:
      tags:
        - Accounts
      summary: Create account
      description: Create a new financial account
      operationId: createAccount
      security:
        - ClerkAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateAccountRequest'
      responses:
        '201':
          description: Account created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Account'
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /accounts/{id}:
    get:
      tags:
        - Accounts
      summary: Get account by ID
      description: Retrieve a specific account by its ID
      operationId: getAccount
      security:
        - ClerkAuth: []
      parameters:
        - $ref: '#/components/parameters/AccountIdParam'
      responses:
        '200':
          description: Account details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Account'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
    
    put:
      tags:
        - Accounts
      summary: Update account
      description: Update an existing account
      operationId: updateAccount
      security:
        - ClerkAuth: []
      parameters:
        - $ref: '#/components/parameters/AccountIdParam'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateAccountRequest'
      responses:
        '200':
          description: Account updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Account'
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /transactions:
    get:
      tags:
        - Transactions
      summary: List transactions
      description: Retrieve a paginated list of transactions with filtering options
      operationId: listTransactions
      security:
        - ClerkAuth: []
      parameters:
        - name: type
          in: query
          description: Filter by transaction type
          required: false
          schema:
            type: string
            enum: [income, expense, transfer, payment]
        - name: status
          in: query
          description: Filter by transaction status
          required: false
          schema:
            type: string
        - name: category
          in: query
          description: Filter by category
          required: false
          schema:
            type: string
        - name: startDate
          in: query
          description: Start date (ISO 8601 format)
          required: false
          schema:
            type: string
            format: date-time
        - name: endDate
          in: query
          description: End date (ISO 8601 format)
          required: false
          schema:
            type: string
            format: date-time
        - name: search
          in: query
          description: Search term
          required: false
          schema:
            type: string
        - $ref: '#/components/parameters/LimitParam'
        - name: offset
          in: query
          description: Number of records to skip
          required: false
          schema:
            type: integer
            default: 0
      responses:
        '200':
          description: List of transactions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TransactionListResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'
    
    post:
      tags:
        - Transactions
      summary: Create transaction
      description: Create a new transaction
      operationId: createTransaction
      security:
        - ClerkAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateTransactionRequest'
      responses:
        '201':
          description: Transaction created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Transaction'
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'

components:
  securitySchemes:
    ClerkAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: Clerk session token

  parameters:
    PageParam:
      name: page
      in: query
      description: Page number (1-indexed)
      required: false
      schema:
        type: integer
        default: 1
        minimum: 1
    
    LimitParam:
      name: limit
      in: query
      description: Number of items per page
      required: false
      schema:
        type: integer
        default: 20
        minimum: 1
        maximum: 100
    
    AccountIdParam:
      name: id
      in: path
      required: true
      description: Account ID
      schema:
        type: string

  schemas:
    HealthStatus:
      type: object
      properties:
        status:
          type: string
          enum: [healthy, degraded, unhealthy]
        timestamp:
          type: string
          format: date-time
        services:
          type: object
          properties:
            database:
              type: object
              properties:
                status:
                  type: string
                responseTime:
                  type: number
            api:
              type: object
              properties:
                status:
                  type: string
        metrics:
          type: object
          properties:
            responseTime:
              type: number
            memoryUsage:
              type: number
            cpuUsage:
              type: number

    Account:
      type: object
      properties:
        id:
          type: string
          format: uuid
        userId:
          type: string
        accountName:
          type: string
        accountType:
          type: string
          enum: [checking, savings, credit_card, investment, loan, other]
        bankName:
          type: string
          nullable: true
        currency:
          type: string
          default: USD
        balance:
          type: number
        status:
          type: string
          enum: [active, inactive, closed]
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    CreateAccountRequest:
      type: object
      required:
        - accountName
        - accountType
      properties:
        accountName:
          type: string
          minLength: 1
        accountType:
          type: string
          enum: [checking, savings, credit_card, investment, loan, other]
        bankName:
          type: string
        currency:
          type: string
          default: USD
        openingBalance:
          type: number
          default: 0
        notes:
          type: string

    UpdateAccountRequest:
      type: object
      properties:
        accountName:
          type: string
        accountType:
          type: string
          enum: [checking, savings, credit_card, investment, loan, other]
        status:
          type: string
          enum: [active, inactive, closed]
        notes:
          type: string

    AccountListResponse:
      type: object
      properties:
        accounts:
          type: array
          items:
            $ref: '#/components/schemas/Account'
        pagination:
          $ref: '#/components/schemas/Pagination'

    Transaction:
      type: object
      properties:
        id:
          type: string
          format: uuid
        userId:
          type: string
        type:
          type: string
          enum: [income, expense, transfer, payment]
        amount:
          type: number
        currency:
          type: string
        description:
          type: string
        category:
          type: string
        transactionDate:
          type: string
          format: date-time
        status:
          type: string
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    CreateTransactionRequest:
      type: object
      required:
        - type
        - amount
        - transactionDate
      properties:
        type:
          type: string
          enum: [income, expense, transfer, payment]
        amount:
          type: number
          minimum: 0.01
        currency:
          type: string
          default: USD
        description:
          type: string
        category:
          type: string
        accountId:
          type: string
          format: uuid
        transactionDate:
          type: string
          format: date-time
        notes:
          type: string

    TransactionListResponse:
      type: object
      properties:
        transactions:
          type: array
          items:
            $ref: '#/components/schemas/Transaction'
        total:
          type: integer

    Pagination:
      type: object
      properties:
        page:
          type: integer
        limit:
          type: integer
        total:
          type: integer
        totalPages:
          type: integer
        hasNext:
          type: boolean
        hasPrev:
          type: boolean

    ApiError:
      type: object
      properties:
        code:
          type: string
        message:
          type: string
        details:
          type: object
        timestamp:
          type: string
          format: date-time
        requestId:
          type: string

  responses:
    Unauthorized:
      description: Authentication required
      content:
        application/json:
          schema:
            type: object
            properties:
              error:
                $ref: '#/components/schemas/ApiError'
    
    ValidationError:
      description: Validation error
      content:
        application/json:
          schema:
            type: object
            properties:
              error:
                allOf:
                  - $ref: '#/components/schemas/ApiError'
                  - type: object
                    properties:
                      code:
                        type: string
                        example: VALIDATION_ERROR
                      details:
                        type: array
                        items:
                          type: object
    
    NotFound:
      description: Resource not found
      content:
        application/json:
          schema:
            type: object
            properties:
              error:
                allOf:
                  - $ref: '#/components/schemas/ApiError'
                  - type: object
                    properties:
                      code:
                        type: string
                        example: NOT_FOUND
    
    InternalServerError:
      description: Internal server error
      content:
        application/json:
          schema:
            type: object
            properties:
              error:
                allOf:
                  - $ref: '#/components/schemas/ApiError'
                  - type: object
                    properties:
                      code:
                        type: string
                        example: INTERNAL_SERVER_ERROR
